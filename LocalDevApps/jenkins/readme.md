# Jenkins - Install & Config on Minikube

ref's:

- <https://www.jenkins.io/doc/book/installing/kubernetes/>
- <https://www.enterprisedb.com/blog/how-deploy-pgadmin-kubernetes>

NameSpace:

- Create namespace: `kubectl create namespace jenkins`

- Install Jenkins with Helm
  - Verify if Jenkins Repo is loaded:
    - `helm search repo jenkinsci`
  - Add repo:
    - `helm repo add jenkinsci https://charts.jenkins.io`
    - `helm repo update`

- Create a Persistent Volume:
  - Create the Volume & Access minikube & create the folder
    - `minikube ssh`
    - `sudo mkdir /data/jenkins-volume`
    - `sudo chown -R 1000:1000 /data/jenkins-volume`
    - `exit`
    - `kubectl apply -f jenkins-volume.yaml`

<!-- - Create a service account called jenkins:
  - `kubectl apply -f jenkins-sa.yaml` -->

- Install Jenkins:
  - In the jenkins-values.yaml we changed this:
    - nodePort: Because we are using minikube we need to use NodePort as service type. Only cloud providers offer load balancers. We define port 32000 as port (Line 129, 145)
    - storageClass: (line: 811)
        storageClass: jenkins-pv
    - serviceAccount: the serviceAccount section of the jenkins-values.yaml file should look like this, (line 847):
    - `serviceAccount:`
      - `create: false`
    - Service account name is autogenerated by default
      - `name: jenkins`
      - `annotations: {}`
    - Where `name: jenkins` refers to the serviceAccount created for jenkins
  
- Execute helm install
  - `chart=jenkinsci/jenkins`
  - `helm install jenkins -n jenkins -f jenkins-values.yaml $chart`
  - In case it fails to running again use:
    - `helm upgrade --install jenkins -n jenkins -f jenkins-values.yaml $chart`

- If use the jenkins-values-last.yaml --> have to add the ip to the host file & enable ingress to access jenkins
  - Get the minikube ip
    - ```minikube ip```
  - add the ip to host file
    - ```sudo nano /etc/hosts```
    - add this line:
      - ```192.168.49.2 jenkins.local```

  - Enable Ingress
    - ```minikube addons list```
    - ```minikube -p minik-01 addons enable ingress```

- NOTES:
  - Get your 'admin' user password by running\
  
    `kubectl exec --namespace jenkins -it svc/jenkins -c jenkins -- /bin/cat /run/secrets/additional/chart-admin-password && echo`

  - Get the Jenkins URL to visit by running these commands in the same shell\
  
    ``` (sh)
    export NODE_PORT=$(kubectl get --namespace jenkins -o jsonpath="{.spec.ports[0].nodePort}" services jenkins)
    export NODE_IP=$(kubectl get nodes --namespace jenkins -o jsonpath="{.items[0].status.addresses[0].address}")
    echo http://$NODE_IP:$NODE_PORT/login
    ```

- Get the minikube IP:
  - ```minikube ip```
  - Jenkins: <http://192.168.67.2:32000>

github : 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

Jenkins: k3MsBGFAE6rUCR7orGcWUZ
